<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carbon Footprint Calculator</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="container">
      <h1>Carbon Footprint Calculator</h1>
      <p>Enter your activity details to estimate your annual CO₂ emissions.</p>

      <!-- Transportation -->
      <div class="section">
        <h2>Transportation</h2>

        <label for="carKm">Travel Distance (km/year):</label>
        <input type="number" id="carKm" placeholder="e.g. 1000" />

        <label for="vehicleType">Vehicle Type:</label>
        <select id="vehicleType">
          <option value="car">Car</option>
          <option value="bike">Bike</option>
        </select>

        <label for="fuelType">Fuel Type:</label>
        <select id="fuelType">
          <option value="petrol">Petrol</option>
          <option value="diesel">Diesel</option>
          <option value="cng">CNG</option>
          <option value="electricity">Electric (EV)</option>
        </select>
        <span class="hint">Fuel type may be locked for some vehicle types (train, bus, flights).</span>
      </div>

      <!-- Electricity -->
      <div class="section">
        <h2>Home Electricity</h2>
        <label for="electricityUsage">Electricity Usage (kWh/year):</label>
        <input type="number" id="electricityUsage" placeholder="e.g. 300" />
      </div>

      <!-- Food -->
      <div class="section">
        <h2>Food</h2>
        <label for="dietType">Diet Type:</label>
        <select id="dietType">
          <option value="none">None (do not include food emissions)</option>
          <option value="meat_heavy">Meat-heavy</option>
          <option value="average" selected>Average / Mixed</option>
          <option value="vegetarian">Vegetarian</option>
          <option value="vegan">Vegan</option>
        </select>
        <span class="hint">Rough annual emissions per person depending on diet.</span>
      </div>

      <!-- Waste & Recycling -->
      <div class="section">
        <h2>Waste &amp; Recycling</h2>
        <label for="wasteKgPerWeek">Household Waste (kg/week):</label>
        <input type="number" id="wasteKgPerWeek" placeholder="e.g. 10" />

        <label for="recyclingRate">Recycled (% of total waste):</label>
        <input type="number" id="recyclingRate" placeholder="e.g. 20" value="0" min="0" max="100" />
        <span class="hint">Only the non‑recycled portion is treated as landfilled.</span>
      </div>

        <div class="section">
        <h2>Water Usage</h2>
        <label for="waterLitersPerDay">Water Usage (litres/day):</label>
        <input
          type="number"
          id="waterLitersPerDay"
          placeholder="e.g. 150"
        />
        <span class="hint">
          Approximate total household water use per person per day (showers, washing, cooking, etc.).
        </span>
      </div>

      <button id="calculateBtn">Calculate</button>

      <div id="resultBox">
        <h2>Result</h2>
        <p id="result">Your CO₂ footprint will appear here.</p>
      </div>
    </div>

    <script>
  document.addEventListener("DOMContentLoaded", () => {
    const vehicleTypeSelect = document.getElementById("vehicleType");
    const fuelTypeSelect = document.getElementById("fuelType");

    function updateFuelTypeLock() {
      const vt = vehicleTypeSelect.value;

      if (vt === "train") {
        // Train → Electric only
        fuelTypeSelect.value = "electricity";
        fuelTypeSelect.disabled = true;
      } else if (vt === "bus" || vt === "flight_short" || vt === "flight_long") {
        // Bus / Flights → Diesel only
        fuelTypeSelect.value = "diesel";
        fuelTypeSelect.disabled = true;
      } else {
        // Car, Bike, etc. → user can choose
        fuelTypeSelect.disabled = false;
      }
    }

    // Initial lock and on change
    updateFuelTypeLock();
    vehicleTypeSelect.addEventListener("change", updateFuelTypeLock);

    function toNumber(value, fallback = 0) {
      const n = parseFloat(value);
      return Number.isFinite(n) ? n : fallback;
    }

    document.getElementById("calculateBtn").onclick = async () => {
      try {
        // Read and convert inputs to numbers where appropriate
        const carKm = toNumber(document.getElementById("carKm").value, 0);
        const vehicleType = vehicleTypeSelect.value;
        const fuelType = fuelTypeSelect.value;
        const electricityUsage = toNumber(document.getElementById("electricityUsage").value, 0);
        const dietType = document.getElementById("dietType").value;
        const wasteKgPerWeek = toNumber(document.getElementById("wasteKgPerWeek").value, 0);
        const recyclingRate = toNumber(document.getElementById("recyclingRate").value, 0);
        const waterLitersPerDay = toNumber(document.getElementById("waterLitersPerDay").value, 0);

        const response = await fetch("http://localhost:5001/api/emissions/calculate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            // send numeric fields as numbers
            carKm,
            vehicleType,
            fuelType,
            electricityUsage,
            dietType,
            wasteKgPerWeek,
            recyclingRate,
            waterLitersPerDay
          })
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();

        // Coerce server values to numbers for safe formatting
        const total = toNumber(data.total, 0);
        const transportCO2 = toNumber(data.transportCO2, 0);
        const electricityCO2 = toNumber(data.electricityCO2, 0);
        const foodCO2 = toNumber(data.foodCO2, 0);
        const wasteCO2 = toNumber(data.wasteCO2, 0);
        const waterCO2 = toNumber(data.waterCO2, 0);

        document.getElementById("result").innerHTML =
          `<div><strong>Total CO₂ Emissions: ${total.toFixed(2)} kg/year</strong></div>` +
          `<div>Transport: ${transportCO2.toFixed(2)} kg</div>` +
          `<div>Electricity: ${electricityCO2.toFixed(2)} kg</div>` +
          `<div>Food: ${foodCO2.toFixed(2)} kg</div>` +
          `<div>Waste: ${wasteCO2.toFixed(2)} kg</div>` +
          `<div>Water: ${waterCO2.toFixed(2)} kg</div>`;
      } catch (err) {
        console.error(err);
        document.getElementById("result").innerText = `Error: ${err.message}`;
      }
    };
  });
</script>
  </body>
</html>